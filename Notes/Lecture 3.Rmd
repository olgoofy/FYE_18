---
title: 'Lecture 3: Baseball stats & Multivariate regression'
author: "Skidmore College, MA 276"
output: beamer_presentation
fontsize: 10pt
---


## Goals

- Player specific measures, baseball pitching statistics

- Example: [Fielding independent pitching](http://sports.yahoo.com/mlb/blog/big_league_stew/post/Everything-you-always-wanted-to-know-about-FIP?urn=mlb,206286)

- Extensions: WAR, deserved run average

- Tools: multivariate regression, player prediction 



## Review: multivariate regression

Model: 

$y_i = \beta_0 + \beta_1*x_{i1} + \beta_2*x_{i2} + \ldots + \beta_{p-1}*x_{i,p-1} + \epsilon_i$


Assumptions: 

- $\epsilon_i \sim N(0, \sigma^2)$
- $\epsilon_i$,$\epsilon_{i'}$ independent for all $i, i'$
- Linear relationship between $y$ and $x$

## Review: multivariate regression

Estimated model:  
  
$\hat{y_i} = \hat{\beta_0} + \hat{\beta_1}*x_{i1} + \hat{\beta_2}*x_{i2} + \ldots + \hat{\beta_{p-1}}*x_{i,p-1}$ 

Interpretations:

- $\hat{\beta_0}$: 
- $\hat{\beta_1}$: 

## Back to baseball

Fielding Independent Pitching (FIP)

1.  Is it important to success?

2.  How well does it measure a player's contribution?

3.  Is it repeatable? 

## Ex: FIP

"measurement of a pitcherâ€™s performance that strips out the role of **defense, luck, and sequencing**"- [FanGraphs](http://www.fangraphs.com/library/pitching/fip/)

- defense
- luck
- sequencing

$FIP = \frac{(13*HR)+(3*(BB+HBP))-(2*K)}{IP} + constant$

## Ex: FIP

```{r, warning = FALSE, message = FALSE}
library(Lahman)
library(mosaic)
data(Teams)

#filter: only look at years starting with 1970 
Teams.1 <- filter(Teams, yearID >= 1970)

#mutate: create new variable FIP
Teams.1 <- mutate(Teams.1, 
    FIP = ((13*HRA) + 3*(BBA) - 2*SOA)/IPouts)
```

## Ex: FIP 

```{r}
fit.pitcher <- lm(RA ~ HRA + BBA + SOA, data = Teams.1)
```

Write the multiple regression model: 



## Ex: FIP

```{r}
msummary(fit.pitcher)
```


## Ex: FIP

```{r, fig.width=6, fig.height=3.6}
qqnorm(fit.pitcher$resid)
```


## Ex: FIP

```{r, fig.width=6, fig.height=3.6}
xyplot(fit.pitcher$resid ~ fit.pitcher$fitted)
```


## Ex: FIP

Write the estimated regression model, interpret slope for `HRA`

```{r}
msummary(fit.pitcher)
```


## Ex: FIP

```{r}
Teams.1 <- mutate(Teams.1, 
   FIP.new = predict(fit.pitcher, Teams.1))
mat <- select(Teams.1, RA, FIP, FIP.new, HRA, BBA, SOA)
cor.matrix <- cor(mat)
round(cor.matrix, 2)
```


## Ex: FIP


```{r, fig.width=5, fig.height=2.6}
library(corrplot)
corrplot(cor.matrix, method="number", type = "lower")
```


## Ex: FIP

Conclusions:

- Multiple regression model estimated FIP (`FIP.new`) closely approximates actual FIP formula 

- High link (team-wide) between FIP and RA 


## To the players!

```{r}
data(Pitching)
head(Pitching)
```


## To the players!

```{r}
Pitchers.1 <- filter(Pitching, yearID >= 1970, IPouts > 200)
Pitchers.1 <- mutate(Pitchers.1,
   FIP = ((13*HR) + 3*(BB + HBP) - 2*SO)/IPouts + 3.1)
Pitchers.1[3,]
```

## Link between ERA, FIP

What accounts for uncertainty? 

```{r, fig.width=6, fig.height=3.6}
xyplot(ERA ~ FIP, data = Pitchers.1)
```


## Link to the future

All of the above is within a single year. How does it project to future years?

```{r}
Pitchers.2 <- Pitchers.1 %>%
  arrange(playerID, yearID) %>%
  group_by(playerID) %>%
  mutate(f.ERA = lead(ERA), f.FIP = lead(FIP))
```


## Link to the future

```{r, fig.width=6, fig.height=3.6}
cor.matrix <- cor(select(ungroup(Pitchers.2), 
    f.ERA, f.FIP,
    ERA, FIP, HR, SO, BB), 
    use="pairwise.complete.obs")
corrplot(cor.matrix, method = "number")
```


## Conclusions

Fielding Independent Pitching (FIP)

1.  Is it important to success? 
  - Yes. Why?

2.  How well does it measure a player's contribution?  
  - Preferred to ERA - Why? 

3.  Is it repeatable? 
  - Moreso than other metrics - Why?
  

## Just for fun

```{r, warning = FALSE, message = FALSE}
Pitchers.2 %>% 
  group_by(playerID) %>%
  tally(G) %>%
  top_n(5)
```

## Just for fun

```{r, warning = FALSE, message = FALSE}
Pitchers.2 %>% 
  filter(IPouts > 600) %>%
  group_by(yearID) %>%
  slice(which.min(FIP)) %>%
  tail() %>% 
  select(playerID, yearID, ERA, FIP, W, L)
```
